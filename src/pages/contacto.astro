---
import '../styles/global.css';
// Component Imports
import Button from '../components/Button.astro';
import BusinessLineCard from '@/components/BusinessLineCard.astro';
import NavBar from '@/components/layout/NavBar.astro';
import BentoItem from '@/components/BentoItem.astro';
import Footer from '@/components/layout/Footer.astro';
import Services from '@/components/services.tsx';

// Full Astro Component Syntax:
// https://docs.astro.build/basics/astro-components/
---

<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="generator" content={Astro.generator} />
		<title>Capital Consultorias SAS</title>
	</head>

	<body>
		<NavBar />
		<main class="container mx-auto px-4 py-8">
			<div class="max-w-2xl mx-auto">
				<h1 class="text-3xl font-bold text-gray-900 mb-8 text-center">Contáctanos</h1>
				
				<form id="contactForm" class="space-y-6">
					<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
						<div>
							<label for="name" class="block text-sm font-medium text-gray-700 mb-2">
								Nombre completo *
							</label>
							<input 
								type="text" 
								id="name" 
								name="name" 
								required
								class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
								placeholder="Tu nombre completo"
							>
						</div>
						
						<div>
							<label for="email" class="block text-sm font-medium text-gray-700 mb-2">
								Email *
							</label>
							<input 
								type="email" 
								id="email" 
								name="email" 
								required
								class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
								placeholder="tu@email.com"
							>
						</div>
					</div>
					
					<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
						<div>
							<label for="phone" class="block text-sm font-medium text-gray-700 mb-2">
								Teléfono
							</label>
							<input 
								type="tel" 
								id="phone" 
								name="phone"
								class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
								placeholder="+57 300 123 4567"
							>
						</div>
						
						<div>
							<label for="subject" class="block text-sm font-medium text-gray-700 mb-2">
								Asunto
							</label>
							<input 
								type="text" 
								id="subject" 
								name="subject"
								class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
								placeholder="¿En qué podemos ayudarte?"
							>
						</div>
					</div>
					
					<div>
						<label for="message" class="block text-sm font-medium text-gray-700 mb-2">
							Mensaje *
						</label>
						<textarea 
							id="message" 
							name="message" 
							required
							rows="6"
							class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
							placeholder="Cuéntanos más detalles sobre tu consulta..."
						></textarea>
					</div>
					
					<div id="formMessage" class="hidden p-4 rounded-md"></div>
					
					<button 
						type="submit" 
						id="submitBtn"
						class="w-full bg-blue-600 text-white py-3 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors duration-200 font-medium"
					>
						<span id="submitText">Enviar mensaje</span>
						<span id="loadingText" class="hidden">Enviando...</span>
					</button>
				</form>
			</div>
		</main>
		<Footer />
		
		<script>
			const contactForm = document.getElementById('contactForm');
			if (contactForm) {
				contactForm.addEventListener('submit', async (e) => {
					e.preventDefault();
					
					const form = e.target as HTMLFormElement;
					const submitBtn = document.getElementById('submitBtn') as HTMLButtonElement;
					const submitText = document.getElementById('submitText');
					const loadingText = document.getElementById('loadingText');
					const formMessage = document.getElementById('formMessage');
					
					if (!submitBtn || !submitText || !loadingText || !formMessage) {
						console.error('Elementos del formulario no encontrados');
						return;
					}
					
					// Mostrar estado de carga
					submitBtn.disabled = true;
					submitText.classList.add('hidden');
					loadingText.classList.remove('hidden');
					formMessage.classList.add('hidden');
					
					try {
						const formData = new FormData(form);
						const data = Object.fromEntries(formData);
						
						const response = await fetch('/api/send', {
							method: 'POST',
							headers: {
								'Content-Type': 'application/json',
							},
							body: JSON.stringify(data)
						});
						
						const result = await response.json();
						
						if (result.success) {
							formMessage.textContent = '¡Mensaje enviado correctamente! Te contactaremos pronto.';
							formMessage.className = 'p-4 rounded-md bg-green-100 text-green-800 border border-green-200';
							form.reset();
						} else {
							formMessage.textContent = result.error || 'Error al enviar el mensaje. Inténtalo de nuevo.';
							formMessage.className = 'p-4 rounded-md bg-red-100 text-red-800 border border-red-200';
						}
					} catch (error) {
						formMessage.textContent = 'Error de conexión. Verifica tu conexión a internet e inténtalo de nuevo.';
						formMessage.className = 'p-4 rounded-md bg-red-100 text-red-800 border border-red-200';
					} finally {
						// Restaurar estado del botón
						submitBtn.disabled = false;
						submitText.classList.remove('hidden');
						loadingText.classList.add('hidden');
						formMessage.classList.remove('hidden');
					}
				});
			}
		</script>
	</body>
</html>
